// Generated by CoffeeScript 1.8.0
var JsProcessor, Processor, path, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Processor = require('./Processor');

path = require('path');

_ = require('lodash');

JsProcessor = (function(_super) {
  __extends(JsProcessor, _super);

  function JsProcessor() {
    return JsProcessor.__super__.constructor.apply(this, arguments);
  }

  JsProcessor.prototype.process = function(content, sourceFile, outputFile, options) {
    if (this.reg == null) {
      this.reg = this.setReplaceTypes(['png', 'jpg', 'gif']);
    }
    content = content.replace(this.reg, (function(_this) {
      return function(all, rest, url) {
        url = _this._getNewUrl(url, path.dirname(sourceFile), path.dirname(outputFile), options);
        return rest + url;
      };
    })(this));
    return content;
  };

  JsProcessor.prototype.setReplaceTypes = function(types) {
    var reg;
    reg = "(['\"])((?:[^'\"\\\\]{1,300})\\\.(?:" + (types.join('|')) + "))(?=['\"\\\\])";
    return this.reg = new RegExp(reg, 'ig');
  };

  return JsProcessor;

})(Processor);

module.exports = JsProcessor;
